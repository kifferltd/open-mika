<title>/k/ Embedded Java Solutions - Mika v1.2 User Manual - Executing Java</title>
<!-- Revision History                                                      -->
<!-- 20031015 First Draft              Chris Gray                          -->
<!-- 20031108 First Revision           Chris Gray                          -->
<!-- 20031218 Renamed to Mika          Chris Gray                          -->
<!-- 20040302 Updated for LxNETES 2.3  Chris Gray                          -->
<!-- 20040416 Updated for Mika 1.1     Chris Gray                          -->
<!-- 20051024 Preliminary version for Mika 1.2     Chris Gray              -->

<body bgcolor=white>

<h2>Executing Java Code on the UNC20</h2>

<p>A simple class which does not form part of a package may be executed
by just dropping the call file (e.g. <tt>HelloWorld.class</tt>)
into the <tt>Mika/fsroot/apps</tt> directory of the target system and typing 
<pre>Mika/mika HelloWorld</pre>
in a telnet or minicom session.
Note that the <tt>.class</tt> suffix must be omitted!

<p>Classes forming part of a package should be arranged hierarchically
under the <tt>Mika/fsroot/apps</tt> directory, e.g. the class files
of package com.acme.myproj should reside in  <tt>Mika/fsroot/apps/com/acme/myproj</tt>. If the launcher for this package in in file <tt>Main.class</tt>
in that directory then it can be run using 
<pre>Mika/mika com.acme.myproj.Main</pre>
.

<p>The default classpath for applications is <tt>{}/apps</tt>, i.e. 
directory <tt>./fsroot/apps</tt> relative to the <tt>mika</tt> binary.
See <a href="#fsroot">"Virtual Filesystem Root"</a> below
for the meaning of the <tt>{}/</tt> notation.
The classpath can be changed, see the next chapter
<a href=Parameters.html>Command-line Parameters and Properties</a>.

<p>A jar file may be executed by dropping it (e.g. <tt>myapp.jar</tt>)
into a directory of the target system (e.g. <tt>Mika/fsroot/apps/myproj</tt>)
and typing 
<pre>Mika/mika -jar {}/apps/myproj/myapp.jar</pre>
.
Note that there is no "default" path for application jar files.

<p>See also 
<a href="#ext-dirs"><tt>java.ext.dirs</tt></a> below
for how to arrange that a jar file is automatically searched to resolve
references when loading applications.

<h3><a id="fsroot">Virtual Filesystem Root</a></h3>

<p>The virtual filesystem root is a feature designed to make it easier to run
the same software in different environments (NFS, flash, etc.). Any path 
beginning with <tt>{}/</tt> is interpreted relative to the virtual filesystem
root. By default the virtual filesystem root is <tt>./fsroot</tt>;
non-absolute paths are evaluated relative to the location of the Mika
binary (not the current directory at the time of launch), so e.g.
if the Mika binary is at <tt>Mika/mika</tt> the virtual filesystem root
defaults to <tt>Mika/fsroot</tt> and Mika will interpret the path
<tt>{}/apps</tt> as <tt>Mika/fsroot/apps</tt>.

<p>The default classpath is <tt>{}/apps</tt> (not <tt>.</tt> as in most desktop
Javas) and the default bootclasspath is <tt>{}/system/:{}/system/wre.jar</tt>.
Thus the system properties file is at location <tt>fsroot/system/system.properties</tt>
and the system class files are at <tt>fsroot/system/wre.jar</tt>.

<p>The <a id="ext-dirs"><tt>java.ext.dirs</tt></a>
system property can be used to define a directory
(or directories) which will automatically be searched when looking for classes.

<h3>Mika Directory Structure</h3>

<p>The <tt>Mika/</tt> directory normally contains just the <tt>mika</tt>
executable and a subdirectory <tt>fsroot/</tt> corresponding to the virtual 
filesystem root. Under <tt>fsroot/</tt> the following conventions are used:
<table width="90%" align=center>
<tr><td valign=top><tt>system/</tt><td valign=top>Contains the runtime environment <tt>wre.jar</tt>
and configuration files such as <tt>system.properties</tt>
<tr><td valign=top><tt>apps/</tt><td valign=top>Contains Java applications, either directly as JAR
files or as a filesystem hierarchy containing <tt>.class</tt> files.
The default classpath is <tt>{}/apps/</tt>.
<tr><td valign=top><tt>system/ext/</tt><td valign=top>Contains libraries used by one or more applications.
</table>

<p>We also suggest that you create a subdirectory called e.g. <tt>data/</tt>
and use this for files generated by applications.

<h3>A Note Concerning <tt>bootclasspath</tt> and <tt>classpath</tt></h3>

<p>There is some confusion surrounding the term "classpath", which has meant
different things at different stages in the evolution of the Java language.
Mika effectively works with three classpaths, corresponding to
<tt>bootclasspath</tt>, <tt>java.ext.dirs</tt>, and <tt>classpath</tt>.

<table width="90%" align=center>
<tr><td valign=top><tt>bootclasspath</tt><td valign=top>When seeking a "system" resource such as
<tt>system.properties</tt> or a "system" class (anything beginning with
"<tt>java.</tt>" or "<tt>wonka.</tt>), <i>only</i> this path is searched.
Defaults to <tt>{}/system/:{}/system/wre.jar</tt>, can be changed using
<tt>-Xbootclasspath:&lt;path&gt;</tt>.
<tr><td valign=top><tt>java.ext.dirs</tt><td valign=top>When seeking a non-system class or
resource on behalf of an application, all JAR files in the extensions
directory are searched before searching <tt>classpath</tt>. 
The extensions directory is specified using the system property 
<tt>java.ext.dirs</tt> .
Defaults to <tt>{}/system/ext/</tt>, can be changed using
<tt>-Djava.ext.dirs=&lt;path&gt;</tt>.
<tr><td valign=top><tt>classpath</tt><td valign=top>When looking for a class 
named on the command line, or when seeking a non-system class or resource 
on behalf of an application, <tt>classpath</tt> is searched
(after <tt>java.ext.dirs.path</tt> if defined).
Defaults to <tt>{}/apps/</tt>, can be changed using
<tt>-classpath &lt;path&gt;</tt>.
</table>

<p>A full discussion of Java class loading is beyond the scope of this document.
The remarks above are intended merely to clarify the way some concepts are
handled in Mika and their relation to the directory structure.

<h3>Security</h3>

<p>In the version of Mika supplied with the development kit, 
the fine-grained access control mechanism of Java2 is disabled.
We did this because most Java applications for UNC20 will not require this
kind of "who is allowed to do what" access control, just as native code is
generally all run as "root". Fine-grained access control also imposes a
run-time overhead which should be avoided if not absolutely necessary.
An alternative build including fine-grained access control is available
as part of the Field Trial package.

<p>Note that the absence of fined-grained access control does not by itself
render Java "insecure". All the language features which aid in the development
of secure and reliable software are still there - buffers cannot overflow,
stale or invalid pointers cannot exist, and so forth. However all code is
regarded as "trusted", so it can for example read or write any file or
reboot the system. Fine-grained access control becomes valuable when it is
desired to run code which is in some sense not fully trusted, such as code
supplied by the end-user of a system or by a third party.

<h3>Serial Port Access</h3>

<p>In order to access the serial ports of the UNC20 using the <tt>javax.comm</tt>
package, the file <tt>Mika/fsroot/system/device.config</tt> needs to be modified.
Enable the relevant <tt>register-serial-device</tt> and
<tt>attach-serial-device</tt> lines by deleting the '(' and ')' which surround them.

<p align=center><small>[
<a href="index.html">Index</a>
] - [
Previous : <a href="Demo.html">Running the Demo Projects</a>
] - [
Next : <a href="Debug.html">Debugging Java Code on the UNC20</a>
]</small></p>

