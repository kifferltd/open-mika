###########################################################################
# Parts copyright (c) 2001 by Punch Telematix.  All rights reserved.      #
# Parts copyright (c) 2016 by Chris Gray, KIFFER Ltd.                     #
# All rights reserved.                                                    #
#                                                                         #
# Redistribution and use in source and binary forms, with or without      #
# modification, are permitted provided that the following conditions      #
# are met:                                                                #
# 1. Redistributions of source code must retain the above copyright       #
#    notice, this list of conditions and the following disclaimer.        #
# 2. Redistributions in binary form must reproduce the above copyright    #
#    notice, this list of conditions and the following disclaimer in the  #
#    documentation and/or other materials provided with the distribution. #
# 3. Neither the name of Punch Telematix or of KIFFER Ltd nor the names   #
#    of other contributors may be used to endorse or promote products     #
#    derived from this software without specific prior written permission.#
#                                                                         #
# THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESS OR IMPLIED          #
# WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF    #
# MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.    #
# IN NO EVENT SHALL PUNCH TELEMATIX, KIFFER LTD OR OTHER CONTRIBUTORS BE  #
# LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR     #
# CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF    #
# SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR         #
# BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,   #
# WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE    #
# OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN  #
# IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.                           #
###########################################################################

SubDir WONKA_TOP tool mauve src jnitest_natives ;

LOCATE_TARGET = $(OROOT)/wonka/bin ;

SUBDIRHDRS += $(WONKA_TOP)/core-vm/include ;

CCFLAGS += -fPIC ;

SUFSHR = .so ;
if $(HW_DOUBLES) = true {
  JNITESTS_LIB = ;
}
else {
  JNITESTS_LIB = libjnitests ;
  Library $(JNITESTS_LIB) : ieee754.c ;
}

LinkLibraries libJNIArrayTest$(SUFSHR) : $(JNITESTS_LIB) ;
LinkLibraries libJNIPrimitiveTest$(SUFSHR) : $(JNITESTS_LIB) ;

Main libJNIArrayTest$(SUFSHR) : JNIArrayTest.c ;
Main libJNIClassAccessTest$(SUFSHR) : JNIClassAccessTest.c ;
Main libJNIClassConstructionTest$(SUFSHR) : JNIClassConstructionTest.c ;
Main libJNIMemberAccessTest$(SUFSHR) : JNIMemberAccessTest.c ;
Main libJNIObjectFunctionAccessTest$(SUFSHR) : JNIObjectFunctionAccessTest.c ;
Main libJNIPrimitiveFunctionAccessTest$(SUFSHR) : JNIPrimitiveFunctionAccessTest.c ;
Main libJNIPrimitiveTest$(SUFSHR) : JNIPrimitiveTest.c ;
Main libJNIStringTest$(SUFSHR) : JNIStringTest.c ;

switch $(CPU) {
  case x86 : {
    LINKFLAGS on libJNIArrayTest$(SUFSHR)  = -m32 -shared ;
    LINKFLAGS on libJNIClassAccessTest$(SUFSHR) = -m32 -shared ;
    LINKFLAGS on libJNIClassConstructionTest$(SUFSHR) = -m32 -shared ;
    LINKFLAGS on libJNIMemberAccessTest$(SUFSHR) = -m32 -shared ;
    LINKFLAGS on libJNIObjectFunctionAccessTest$(SUFSHR) = -m32 -shared ;
    LINKFLAGS on libJNIPrimitiveFunctionAccessTest$(SUFSHR) = -m32 -shared ;
    LINKFLAGS on libJNIPrimitiveTest$(SUFSHR) = -m32 -shared ;
    LINKFLAGS on libJNIStringTest$(SUFSHR) = -m32 -shared ;
  }

  case * : {
    LINKFLAGS on libJNIArrayTest$(SUFSHR)  = -shared ;
    LINKFLAGS on libJNIClassAccessTest$(SUFSHR) = -shared ;
    LINKFLAGS on libJNIClassConstructionTest$(SUFSHR) = -shared ;
    LINKFLAGS on libJNIMemberAccessTest$(SUFSHR) = -shared ;
    LINKFLAGS on libJNIObjectFunctionAccessTest$(SUFSHR) = -shared ;
    LINKFLAGS on libJNIPrimitiveFunctionAccessTest$(SUFSHR) = -shared ;
    LINKFLAGS on libJNIPrimitiveTest$(SUFSHR) = -shared ;
    LINKFLAGS on libJNIStringTest$(SUFSHR) = -shared ;
  }
}

LINKLIBS  on libJNIArrayTest$(SUFSHR)  = "" ;
LINKLIBS  on libJNIClassAccessTest$(SUFSHR) = "" ;
LINKLIBS  on libJNIClassConstructionTest$(SUFSHR) = "" ;
LINKLIBS  on libJNIMemberAccessTest$(SUFSHR) = "" ;
LINKLIBS  on libJNIObjectFunctionAccessTest$(SUFSHR) = "" ;
LINKLIBS  on libJNIPrimitiveFunctionAccessTest$(SUFSHR) = "" ;
LINKLIBS  on libJNIPrimitiveTest$(SUFSHR) = "" ;
LINKLIBS  on libJNIStringTest$(SUFSHR) = "" ;

InstallBin $(INSTALLTESTDIR) : libJNIArrayTest$(SUFSHR) ;
InstallBin $(INSTALLTESTDIR) : libJNIClassAccessTest$(SUFSHR) ;
InstallBin $(INSTALLTESTDIR) : libJNIClassConstructionTest$(SUFSHR) ;
InstallBin $(INSTALLTESTDIR) : libJNIMemberAccessTest$(SUFSHR) ;
InstallBin $(INSTALLTESTDIR) : libJNIObjectFunctionAccessTest$(SUFSHR) ;
InstallBin $(INSTALLTESTDIR) : libJNIPrimitiveFunctionAccessTest$(SUFSHR) ;
InstallBin $(INSTALLTESTDIR) : libJNIPrimitiveTest$(SUFSHR) ;
InstallBin $(INSTALLTESTDIR) : libJNIStringTest$(SUFSHR) ;

